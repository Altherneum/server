#!/bin/bash

clear

[ -r /etc/lsb-release ] && . /etc/lsb-release

if [ -z "$DISTRIB_DESCRIPTION" ] && [ -x /usr/bin/lsb_release ]; then
    DISTRIB_DESCRIPTION=$(lsb_release -s -d)
fi

printf "ğŸ§\tOS\t\t$(uname -o)\n"
printf "ğŸ–²ï¸\tDistribution\t$DISTRIB_DESCRIPTION\n"
printf "ğŸ“Ÿ\tVersion\t\t$(uname -r)\t$(uname -m)\n"

printf "\n"

printf "âŒ›\tUptime\t\t$(uptime -p)\n"
printf "ğŸ“…\tDepuis\t\t$(uptime -s)\n"

printf "\n"

freeh=$(free -h)
freem=$(free -m)
meminfo=$(cat /proc/meminfo)
availmem="$(awk -v arcsize="0" '/^MemAvailable:/ { print $2 + 0 }' <<< "${meminfo}")"
usedmem="$(awk -v availmem="${availmem}" '/^MemTotal:/ { print $2 - availmem }' <<< "${meminfo}")"
totalmem="$(awk '/^MemTotal:/ { print $2 }' <<< "${meminfo}")"
used="$(numfmt --round=down --from-unit=1024 --to=iec <<< "${usedmem}")"
avail="$(numfmt --round=down --from-unit=1024 --to=iec <<< "${availmem}")"
total="$(numfmt --round=down --from-unit=1024 --to=iec <<< "${totalmem}")"
percentage=$(((usedmem*100 / totalmem*100) /100))

printf "ğŸ’»\tCPU\t\t$(uptime | cut -d ',' -f 4-6 | sed -e 's/^[ \t]*//')\n"
printf "ğŸ§ \tRAM\t\t$used / $total : $percentage%%\n"
printf "ğŸ’¾\tSDA\n"
df -hl /dev/sda* | grep -v udev

printf "\n"

printf "ğŸ’¾\tHÃ´te\t\t$(hostname)\n"

printf "\n"

printf "ğŸ“¶\tVPS\t\t$(hostname -I)\n"
printf "ğŸ›œ\tVous\t\t$(echo $SSH_CLIENT)\n"

printf "\n"

printf "ğŸ‘€\tUtilisateurs\t$(who | sort -u | wc -l)\n"
printf "â¡ï¸\tListe :\n$(who)\n"

printf "\n"

printf "ğŸ‘€\tDerniÃ¨res connexions ğŸ†— : \n"
last | head

printf "\n"

printf "ğŸ‘€\tDerniÃ¨res connexions ğŸ”´ : \n"
lastb | head

printf "\n"

printf "ğŸš¨\tFail2Ban ğŸ‘® : \n"
fail2ban-client status sshd

printf "\n"

printf "ğŸš§\tServices ğŸ‘¨â€ğŸ’» : \n"
printf "ğŸ“\tDiscord\t\t$(systemctl check discord)\n"
printf "âš”ï¸\tMinecraft\t$(systemctl check minecraft)\n"
printf "ğŸŒ\tApache2\t\t$(systemctl check apache2)\n"
printf "ğŸ’¿\tMySQL\t\t$(systemctl check mysql)\n"

printf "\n"
