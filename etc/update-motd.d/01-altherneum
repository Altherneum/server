#!/bin/bash

clear

[ -r /etc/lsb-release ] && . /etc/lsb-release

if [ -z "$DISTRIB_DESCRIPTION" ] && [ -x /usr/bin/lsb_release ]; then
    DISTRIB_DESCRIPTION=$(lsb_release -s -d)
fi

printf "ğŸ§\tOS\t\t$(uname -o)\n"
printf "ğŸ–²ï¸\tDistribution\t$DISTRIB_DESCRIPTION\n"
printf "ğŸ“Ÿ\tVersion\t\t$(uname -r)\t$(uname -m)\n"

printf "\n"

printf "âŒ›\tUptime\t\t$(uptime -p)\n"
printf "ğŸ“…\tDepuis\t\t$(uptime -s)\n"

printf "\n"

freeh=$(free -h)
freem=$(free -m)
meminfo=$(cat /proc/meminfo)
availmem="$(awk -v arcsize="0" '/^MemAvailable:/ { print $2 + 0 }' <<< "${meminfo}")"
usedmem="$(awk -v availmem="${availmem}" '/^MemTotal:/ { print $2 - availmem }' <<< "${meminfo}")"
totalmem="$(awk '/^MemTotal:/ { print $2 }' <<< "${meminfo}")"
used="$(numfmt --round=down --from-unit=1024 --to=iec <<< "${usedmem}")"
avail="$(numfmt --round=down --from-unit=1024 --to=iec <<< "${availmem}")"
total="$(numfmt --round=down --from-unit=1024 --to=iec <<< "${totalmem}")"
percentage=$(((usedmem*100 / totalmem*100) /100))

printf "ğŸ’»\tCPU\t\t$(uptime | cut -d ',' -f 4-6 | sed -e 's/^[ \t]*//')\n"
printf "ğŸ§ \tRAM\t\t$used / $total : $percentage%%\n"
printf "ğŸ’¾\tSDA\n"
df -hl /dev/sda* | grep -v udev

printf "\n"

printf "ğŸ’¾\tHÃ´te\t\t$(hostname)\n"

printf "\n"

printf "ğŸ“¶\tVPS\t\t$(hostname -I)\n"

printf "\n"

printf "ğŸ‘€\tUtilisateurs\t$(who | sort -u | wc -l)\n"
printf "â¡ï¸\tListe :\n$(who)\n"

printf "\n"

printf "/var/log/wtmp (last) :"
printf "ğŸ‘€\tDerniÃ¨res connexions\tğŸ†—\n"
last | head

printf "\n"

printf "/var/log/btmp (lastb) :"
printf "ğŸ‘€\tDerniÃ¨res connexions\tğŸ”´\n"
lastb | head

printf "\n"

printf "ğŸš¨\tFail2Ban\tğŸ‘®\tSSHD\n"
fail2ban-client status sshd

printf "\n"

printf "ğŸš¨\tFail2Ban\tğŸ‘®\tCode-Server\n"
fail2ban-client status code-server

printf "\n"

printf "ğŸš§\tServices\t\tâš¡\t\tğŸ’¤\n"
printf "â˜ï¸\tDiscord\t\t\t$(systemctl is-enabled discord)\t\t$(systemctl check discord)\n"
printf "ğŸŒ\tApache2\t\t\t$(systemctl is-enabled apache2)\t\t$(systemctl check apache2)\n"
printf "ğŸ’¿\tMySQL\t\t\t$(systemctl is-enabled mysql)\t\t$(systemctl check mysql)\n"
printf "ğŸ’¾\tCode-Server\t\t$(systemctl is-enabled code-server@vscode)\t\t$(systemctl check code-server@vscode)\n"
printf "ğŸš«\tFail2Ban\t\t$(systemctl is-enabled fail2ban)\t\t$(systemctl check fail2ban)\n"
printf "ğŸ’\tMinecraft\t\t$(systemctl is-enabled minecraft)\t$(systemctl check minecraft)\n"
printf "â˜ ï¸\tMinecraft@Anarchie\t$(systemctl is-enabled minecraft@anarchie)\t$(systemctl check minecraft@anarchie)\n"
printf "ğŸ˜ï¸\tMinecraft@CrÃ©atif\t$(systemctl is-enabled minecraft@creatif)\t$(systemctl check minecraft@creatif)\n"
printf "ğŸ‘®\tMinecraft@OPPrison\t$(systemctl is-enabled minecraft@opprison)\t$(systemctl check minecraft@opprison)\n"
printf "âš”ï¸\tMinecraft@RPG\t\t$(systemctl is-enabled minecraft@rpg)\t$(systemctl check minecraft@rpg)\n"
printf "ğŸš©\tMinecraft@Hub\t\t$(systemctl is-enabled minecraft@hub)\t\t$(systemctl check minecraft@hub)\n"
printf "ğŸš¡\tMinecraft@Proxy\t\t$(systemctl is-enabled minecraft@proxy)\t\t$(systemctl check minecraft@proxy)\n"
printf "ğŸ‡\tMinecraft@SkyBlock\t$(systemctl is-enabled minecraft@skyblock)\t\t$(systemctl check minecraft@skyblock)\n"
printf "ğŸ—\tMinecraft@Survie\t$(systemctl is-enabled minecraft@survie)\t\t$(systemctl check minecraft@survie)\n"

printf "\n"