<IfModule mod_ssl.c>

<VirtualHost *:443>
    ServerName altherneum.fr
    ServerAlias www.altherneum.fr docs.altherneum.fr wiki.altherneum.fr info.altherneum.fr
    ServerAdmin root@altherneum.fr

    Redirect 301 / https://doc.altherneum.fr/

    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/altherneum.fr/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/altherneum.fr/privkey.pem
</VirtualHost>

<VirtualHost *:443>
    ServerName github.altherneum.fr

    Redirect 301 / https://github.com/altherneum/
</VirtualHost>

<VirtualHost *:443>
    ServerName git.altherneum.fr
    ServerAdmin root@altherneum.fr

    ProxyPreserveHost On
    ProxyPass / http://127.0.0.1:3003/
    ProxyPassReverse / http://127.0.0.1:3003/

    AllowEncodedSlashes NoDecode

    Include /etc/letsencrypt/options-ssl-apache.conf

    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/altherneum.fr/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/altherneum.fr/privkey.pem

    ProxyRequests Off

    Header set X-Frame-Options "SAMEORIGIN"

    <Location /.well-known/acme-challenge>
        ProxyPass "http://127.0.0.1:3003/.well-known/acme-challenge"
        ProxyPassReverse "http://127.0.0.1:3003/.well-known/acme-challenge"
    </Location>

    <Location />
        AuthType Basic
        AuthName "Please Login"
        AuthUserFile /etc/apache2/.htpasswd-git
        Require user git
    </Location>

    ErrorLog ${APACHE_LOG_DIR}/forgejo.error.log
    CustomLog ${APACHE_LOG_DIR}/forgejo.access.log combined
</VirtualHost>

<VirtualHost *:443>
    ServerName windows.altherneum.fr
    ServerAlias microsoft.altherneum.fr fuckwindows.altherneum.fr fuckmicrosoft.altherneum.fr
    
    Redirect 301 / https://www.youtube.com/watch?v=2zpCOYkdvTQ
    
    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/altherneum.fr/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/altherneum.fr/privkey.pem
</VirtualHost>

<VirtualHost *:443>
    ServerName arch.altherneum.fr
    ServerAlias archterneum.altherneum.fr git.arch.altherneum.fr
    
    Redirect 301 / https://raw.githubusercontent.com/Altherneum/.github/refs/heads/main/note/OS/Linux/Arch/Archterneum/arch.sh
    
    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/altherneum.fr/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/altherneum.fr/privkey.pem
</VirtualHost>

<VirtualHost *:443>
    ServerName code.altherneum.fr
    ServerAlias vscode.altherneum.fr 3000.code.altherneum.fr

    RewriteEngine On
    RewriteCond %{HTTP:Connection} Upgrade [NC]
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteRule /(.*) ws://127.0.0.1:8443/$1 [P,L]

    ProxyRequests Off
    ProxyPreserveHost On

    ProxyPass "/" "http://127.0.0.1:8443/"
    ProxyPassReverse "/" "http://127.0.0.1:8443/"

    Header set X-Frame-Options "SAMEORIGIN"
    
    SSLProxyEngine On
    SSLProxyVerify none
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off

    SSLEngine On

    SSLCertificateFile /etc/letsencrypt/live/altherneum.fr/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/altherneum.fr/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateChainFile /etc/letsencrypt/live/altherneum.fr/chain.pem
    
    <Location /.well-known/acme-challenge>
        ProxyPass "http://127.0.0.1:8443/.well-known/acme-challenge"
        ProxyPassReverse "http://127.0.0.1:8443/.well-known/acme-challenge"
    </Location>

    <Location />
        AuthType Basic
        AuthName "Please Login"
        AuthUserFile /etc/apache2/.htpasswd-vscode
        Require user vscode
    </Location>

    ErrorLog ${APACHE_LOG_DIR}/vscode.error_log
    CustomLog ${APACHE_LOG_DIR}/vscode.access_log combined
</VirtualHost>

<VirtualHost *:443>
    ServerName keeweb.altherneum.fr
    ServerAlias keepass.altherneum.fr keys.altherneum.fr key.altherneum.fr

    SSLEngine on
    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/altherneum.fr/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/altherneum.fr/privkey.pem

    # KeeWeb Frontend Authentication
    <Location "/">
        AuthType Basic
        AuthName "KeeWeb"
        AuthUserFile /etc/apache2/.htpasswd-keeweb
        Require user keeweb
    </Location>

    # KeeWeb Configuration
    DocumentRoot /var/www/keeweb
    <Directory "/var/www/keeweb">
        AllowOverride None
        Require all granted
    </Directory>

    # WebDAV Configuration
    Alias /webdav /var/www/webdav
    <Directory "/var/www/webdav">
        DAV On
        Options Indexes
        AuthType Basic
        AuthName "WebDAV Access"
        AuthUserFile /etc/apache2/.htpasswd-webdav
        Require user webdav
    </Directory>

    # CORS Headers for WebDAV
    <Location /webdav>
        # Allow OPTIONS without authentication for CORS
        <Limit OPTIONS>
            Require all granted
        </Limit>
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "GET, HEAD, POST, PUT, OPTIONS, MOVE, DELETE, COPY, LOCK, UNLOCK"
        Header always set Access-Control-Allow-Headers "origin, content-type, cache-control, accept, authorization, if-match, destination, overwrite"
        Header always set Access-Control-Allow-Credentials "true"
        Header always set Access-Control-Expose-Headers "ETag"
    </Location>
</VirtualHost>

<VirtualHost *:443>
    ServerName minecraft.altherneum.fr
    ServerAlias play.altherneum.fr mc.altherneum.fr *.altherneum.fr
    ServerAdmin root@altherneum.fr

    DocumentRoot /var/www/html

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    <Directory "/var/www/html">

        Options FollowSymLinks
        AllowOverride All
        Require all granted

    </Directory>

    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/altherneum.fr/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/altherneum.fr/privkey.pem
</VirtualHost>

</IfModule>
